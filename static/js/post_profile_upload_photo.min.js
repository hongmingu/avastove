$(function(){$("#span_base_reset").click(function(){$("#modal_base_reset").modal("show")});$("#btn_base_reset_ok").click(function(){$.ajax({url:"/re/create/new/remove_photo/",type:"post",dataType:"json",cache:false,data:{command:"remove_photo",post_id:$("#post_id").attr("data-u")},success:function(data){if(data.res===1){$("#img_300").attr("src",data.src);$("#modal_base_reset").modal("hide")}}})});$("#span_change_photo").click(function(e){e.preventDefault();$("#input_file").click()});$("#input_file").change(function(){if(this.files&&this.files[0]){if(this.files[0].size>1048576*10){var agent=navigator.userAgent.toLowerCase();if(navigator.appName=="Netscape"&&navigator.userAgent.search("Trident")!=-1||agent.indexOf("msie")!=-1){$("#input_file").replaceWith($("#input_file").clone(true))}else{$("#input_file").val("")}alert("File size can't exceed 10m");return}var reader=new FileReader;reader.onload=function(e){$("#img_crop").attr("src",e.target.result);$("#modal_crop").modal("show")};reader.readAsDataURL(this.files[0])}});var image;var cropper;$("#modal_crop").on("shown.bs.modal",function(){image=document.getElementById("img_crop");cropper=new Cropper(image,{viewMode:2,minCropBoxWidth:300,minCropBoxHeight:300,aspectRatio:1/1})}).on("hidden.bs.modal",function(){cropper.destroy();var agent=navigator.userAgent.toLowerCase();if(navigator.appName=="Netscape"&&navigator.userAgent.search("Trident")!=-1||agent.indexOf("msie")!=-1){$("#input_file").replaceWith($("#input_file").clone(true))}else{$("#input_file").val("")}});$(".js-zoom-in").click(function(){cropper.zoom(.1)});$(".js-zoom-out").click(function(){cropper.zoom(-.1)});$(".js-crop-and-upload").click(function(){var cropData=cropper.getData();var form_file=$("#form_upload")[0];var form_data=new FormData(form_file);form_data.append("x",cropData["x"]);form_data.append("y",cropData["y"]);form_data.append("height",cropData["height"]);form_data.append("width",cropData["width"]);form_data.append("rotate",cropData["rotate"]);form_data.append("post_id",$("#post_id").attr("data-u"));$.ajax({url:"/re/create/new/upload_photo/",type:"post",dataType:"json",cache:false,processData:false,contentType:false,data:form_data,success:function(data){$("#modal_crop").modal("hide");if(data.res===1){$("#img_300").attr("src",data.url)}}})})});